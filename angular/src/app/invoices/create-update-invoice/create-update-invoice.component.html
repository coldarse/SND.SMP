<form
  class="form-horizontal"
  autocomplete="off"
  #createInvoiceModal="ngForm"
  (ngSubmit)="save()"
>
  <abp-modal-header
    [title]="
      isCreate == true
        ? ('Add Invoice' | localize)
        : ('Edit Invoice' | localize)
    "
    (onCloseClick)="bsModalRef.hide()"
  ></abp-modal-header>
  <div class="modal-body">
    <div class="form-group row required">
      <label class="col-md-3 col-form-label" for="Date">
        {{ "Date" | localize }}
      </label>
      <div class="col-md-5">
        <select
          name="month"
          id="month"
          class="form-control"
          [(ngModel)]="selected_month"
          (change)="selectedDate($event)"
        >
          @for (month of months; track $index) {
          <option value="{{ month }}">
            {{ month }}
          </option>
          }
        </select>
      </div>
      <div class="col-md-4">
        <select
          name="year"
          id="year"
          class="form-control"
          [(ngModel)]="selected_year"
          (change)="selectedDate($event)"
        >
          @for (year of years; track $index) {
          <option value="{{ year }}">
            {{ year }}
          </option>
          }
        </select>
      </div>
    </div>
    <div class="form-group row required">
      <label class="col-md-3 col-form-label" for="customer">
        {{ "Customer" | localize }}
      </label>
      <div class="col-md-9">
        <select
          name="customer"
          id="customer"
          class="form-control"
          (change)="selectedCustomer($event)"
        >
          <option value="">Select a Customer</option>
          @for (customer of customers; track $index) {
          <option value="{{ customer.code }}">
            {{ customer.companyName }}
          </option>
          }
        </select>
      </div>
    </div>
    <div class="form-group row required">
      <label class="col-md-3 col-form-label" for="invoiceNo">
        {{ "InvoiceNo" | localize }}
      </label>
      <div class="col-md-9">
        <input
          type="text"
          class="form-control"
          name="invoiceNo"
          id="invoiceNo"
          required
          [(ngModel)]="invoice_info.invoiceNo"
          #invoiceNoModel="ngModel"
          #invoiceNoEl
        />
        <abp-validation-summary
          [control]="invoiceNoModel"
          [controlEl]="invoiceNoEl"
        ></abp-validation-summary>
      </div>
    </div>
    <div class="form-group row required">
      <label class="col-md-3 col-form-label" for="dateTime">
        {{ "DateTime" | localize }}
      </label>
      <div class="col-md-9">
        <input
          type="text"
          class="form-control"
          name="dateTime"
          id="dateTime"
          required
          [(ngModel)]="invoice_info.invoiceDate"
          #dateTimeModel="ngModel"
          #dateTimeEl
        />
        <abp-validation-summary
          [control]="dateTimeModel"
          [controlEl]="dateTimeEl"
        ></abp-validation-summary>
      </div>
    </div>
    <div class="form-group row required">
      <label class="col-md-3 col-form-label" for="dispatches">
        {{ "Dispatches" | localize }}
      </label>
      <div class="col-md-9">
        <!-- <ng-select
          [items]="dispatches"
          [multiple]="true"
          placeholder="Select dispatches"
          [(ngModel)]="selected_dispatches"
          [ngModelOptions]="{ standalone: true }"
        >
        </ng-select> -->
        <div class="dispatch_container">
          @for (dispatch of dispatches; track $index) {
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="dispatch.selected"
              [ngModelOptions]="{ standalone: true }"
              id="{{dispatch.name}}"
            />
            <label class="form-check-label" for="{{dispatch.name}}">
              {{dispatch.name}}
            </label>
          </div>
          }
        </div>
      </div>
    </div>
    <div class="form-group row required">
      <label class="col-md-3 col-form-label" for="billTo">
        {{ "Bill To" | localize }}
      </label>
      <div class="col-md-9">
        <textarea
          class="form-control"
          name="billTo"
          id="billTo"
          required
          [(ngModel)]="invoice_info.billTo"
          #billToModel="ngModel"
          #billToEl
        ></textarea>
        <abp-validation-summary
          [control]="billToModel"
          [controlEl]="billToEl"
        ></abp-validation-summary>
      </div>
    </div>
    <br />
    <hr />
    <br />
    @if (surharges.length > 0) {
    <div class="row">
      <div class="col-1"><label>Delete</label></div>
      <div class="col-2"><label>Description</label></div>
      <div class="col-1"><label>Weight (KG)</label></div>
      <div class="col-2"><label>Country</label></div>
      <div class="col-1"><label>Rate/KG</label></div>
      <div class="col-1"><label>Quantity</label></div>
      <div class="col-1"><label>Unit Price</label></div>
      <div class="col-2"><label>Amount</label></div>
      <div class="col-1"><label>Currency</label></div>
    </div>
    @for (surcharge of surharges; track $index) {
    <div class="row mb-1">
      <div class="col-1">
        <button
          type="button"
          class="btn btn-danger"
          style="width: 100%"
          (click)="deleteSurcharge($index)"
        >
          <i class="fas fa-minus-circle"></i>
        </button>
      </div>
      <div class="col-2">
        <input
          type="text"
          [(ngModel)]="surcharge.description"
          [ngModelOptions]="{ standalone: true }"
          class="form-control"
          placeholder="Bottle"
        />
      </div>
      <div class="col-1">
        <input
          type="text"
          class="form-control"
          (keypress)="validateAndCalculate($event, $index, 'weight')"
          placeholder="3.015"
        />
      </div>
      <div class="col-2">
        <input
          type="text"
          [(ngModel)]="surcharge.country"
          [ngModelOptions]="{ standalone: true }"
          class="form-control"
          placeholder="Canada"
        />
      </div>
      <div class="col-1">
        <input
          type="text"
          class="form-control"
          (keypress)="validateAndCalculate($event, $index, 'ratePerKG')"
          placeholder="1.05"
        />
      </div>
      <div class="col-1">
        <input
          type="text"
          class="form-control"
          (keypress)="validateAndCalculate($event, $index, 'quantity')"
          placeholder="5"
        />
      </div>
      <div class="col-1">
        <input
          type="text"
          class="form-control"
          (keypress)="validateAndCalculate($event, $index, 'unitPrice')"
          placeholder="4.15"
        />
      </div>
      <div class="col-2">
        <input
          type="number"
          [(ngModel)]="surcharge.amount"
          [ngModelOptions]="{ standalone: true }"
          class="form-control"
          placeholder="5.00"
        />
      </div>
      <div class="col-1">
        <select
          name="currencies"
          id="currencies"
          class="form-control"
          [(ngModel)]="surcharge.currency"
          [ngModelOptions]="{ standalone: true }"
        >
          <option value="">Select</option>
          @for (currency of currencies; track $index) {
          <option value="{{ currency.abbr }}">{{ currency.abbr }}</option>
          }
        </select>
      </div>
    </div>
    } }
    <div class="row mt-1">
      <div class="col-10"></div>
      <div class="col-2">
        <button
          type="button"
          class="btn bg-olive"
          style="width: 100%"
          (click)="addSurcharge()"
        >
          <i class="fas fa-plus"></i> Add Surcharge
        </button>
      </div>
    </div>
  </div>
  <abp-modal-footer
    [cancelDisabled]="saving"
    [saveDisabled]="!createInvoiceModal.form.valid || saving"
    (onCancelClick)="bsModalRef.hide()"
  ></abp-modal-footer>
</form>
